module Main where

import Compiler
import JavaCompiler
import SymbolTable
import IOUtils

import System.Environment

main :: IO ()
main = do

    args <- getArgs
    options <- commandlineArgs args
    let inputDir = "cobalt_src/" -- until issue #333 is resolved
    let javaOutputDir = "cobalt_generated_java/" -- only while we still compile to java

    let isFileToCompile (FileToCompile _ ) = True
        isFileToCompile _ = False
    let isClassPath (ClassPath _ ) = True
        isClassPath _ = False
    let isDestinationDir (DestinationDir _ ) = True
        isDestinationDir _ = False
    let inputFiles = map (\(FileToCompile x) -> x) (filter isFileToCompile options)
    --if multiple class paths or destination dirs are provided, first is taken instead of throwing error
    let javaClasspath = (\(ClassPath cp) -> cp) . (defaultHead (ClassPath "./")) $ filter isClassPath options
    let classOutputDir = (\(DestinationDir dd) -> dd) . (defaultHead (DestinationDir "cobalt_generated_classes/")) $ filter isDestinationDir options

    cleanDir (endsWith ".java") javaOutputDir

    putStrLn "Compiling - Cobalt -> Java"
    compile inputDir javaOutputDir
    putStrLn "Complete."

    putStrLn "Compiling - Java -> Byte code"
    --compileJavaDir javaClasspath javaOutputDir classOutputDir
    putStrLn "Complete."

    putStrLn "Executing generated Byte code"
    putStrLn "Unimplemented."
